<wpfCoreWindow:MetroWindowExt
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:Convertidores="clr-namespace:WPFCore.Convertidores;assembly=WPFCore"
    xmlns:controles="clr-namespace:ComercialColindres.Controls"
    xmlns:convertidoresLocal="clr-namespace:ComercialColindres.Convertidores"
    xmlns:i="http://schemas.microsoft.com/expression/2010/interactivity"
    xmlns:HelpersMahApps="http://metro.mahapps.com/winfx/xaml/controls"
    xmlns:controlsMahApps="clr-namespace:MahApps.Metro.Controls;assembly=MahApps.Metro"
    xmlns:Comportamientos="clr-namespace:WPFCore.Comportamientos;assembly=WPFCore"
    xmlns:misControles="clr-namespace:MisControlesWPF;assembly=MisControlesWPF"
    xmlns:wpfCoreWindow="clr-namespace:WPFCore.UtilidadesWindows;assembly=WPFCore"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008" xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" mc:Ignorable="d"
    x:Class="ComercialColindres.Windows.FacturasWindow"
    Title="Facturas"
    Width="920"
    Height="600"
    MostrarDialogo="{Binding DialogSettings, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
    SaveWindowPosition="True"
    ShowFlyout="{Binding SlidePanelIndice, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
    WindowStartupLocation="CenterScreen">

    <wpfCoreWindow:MetroWindowExt.Resources>
        <Convertidores:BoolToVisibilityConverter x:Key="BoolToVisibilityConverter" />
        <Convertidores:BoolToStringConverter x:Key="BoolToStringConverter" />
        <Convertidores:StateValueToColorConverter x:Key="StateValueToColorConverter" />
        <Convertidores:DateTimeToShortString x:Key="DateTimeToShortString" />
        <convertidoresLocal:EstadoColorConvert x:Key="EstadoColorConvert" />
        <convertidoresLocal:BoolToColorConverter x:Key="BoolToColorConverter" />
    </wpfCoreWindow:MetroWindowExt.Resources>

    <wpfCoreWindow:MetroWindowExt.DataContext>
        <Binding Path="FacturasViewModel" Source="{StaticResource Locator}"/>
    </wpfCoreWindow:MetroWindowExt.DataContext>

    <wpfCoreWindow:MetroWindowExt.Flyouts>
        <controlsMahApps:FlyoutsControl>
            <controlsMahApps:Flyout x:Name="AgregarFacturaFlyout"
                Width="415"                
                Margin="100,0,0,0"
                Header="Crear Factura"
                IsModal="True"
                Position="Right"
                Theme="Adapt">
                <Grid Margin="10">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="*" />
                        <RowDefinition Height="70" />
                    </Grid.RowDefinitions>
                    <ScrollViewer Grid.Row="0" VerticalScrollBarVisibility="Auto">
                        <StackPanel Orientation="Vertical">
                            <misControles:HeaderTextBlock Text="Empresa Destino" />
                            <ComboBox
                                    Margin="5"
                                    Grid.Row="1"
                                    Grid.Column="0"
                                    DisplayMemberPath="Nombre"
                                    ItemsSource="{Binding Sucursales}"
                                    SelectedItem="{Binding SucursalSeleccionada, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                    SelectedValue="{Binding DatoFactura.SucursalId, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                    SelectedValuePath="SucursalId" />
                            <misControles:HeaderTextBlock Text="Planta Origen" />
                            <misControles:InputTextBoxAutoCompleteControl
                                    AutoCompletionList="{Binding ListaPlantasAutoComplete}"       
                                    Buscar="{Binding ComandoBuscarPlantas}"
                                    SelectedItem="{Binding PlantaAutoCompleteSeleccionada, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />
                            <misControles:HeaderTextBlock Text="SubPlanta" Visibility="{Binding Planta.HasSubPlanta, Converter={StaticResource BoolToVisibilityConverter}}"/>
                            <misControles:InputTextBoxAutoCompleteControl
                                    AutoCompletionList="{Binding SubPlantas}"       
                                    Buscar="{Binding CommandSearchSubPlantas}"
                                    SelectedItem="{Binding SubPlantaSelected, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" 
                                    Visibility="{Binding Planta.HasSubPlanta, Converter={StaticResource BoolToVisibilityConverter}}"/>
                            <misControles:HeaderTextBlock Text="Número de Factura" />
                            <misControles:InputTextBox Text="{Binding DatoFactura.NumeroFactura, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" MaxLength="10"/>
                            <CheckBox Margin="5" IsChecked="{Binding DatoFactura.HasUnitPriceItem, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}">La Factura contiene precio unitario por boleta?</CheckBox>
                            <misControles:HeaderTextBlock Grid.Column="0" Text="Tipo de Factura" />
                            <ComboBox
                                        Margin="5"
                                        Grid.Row="1"
                                        Grid.Column="0"
                                        DisplayMemberPath="Descripcion"
                                        ItemsSource="{Binding ListaFacturaCategorias}"
                                        SelectedItem="{Binding FacturaCategoriaSeleccionada, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                        SelectedValue="{Binding DatoFactura.FacturaCategoriaId, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                        SelectedValuePath="FacturaCategoriaId" />
                            <misControles:HeaderTextBlock Text="#PO" 
                                                          Visibility="{Binding DatoFactura.RequiereOrdenCompra, Converter={StaticResource BoolToVisibilityConverter}}"/>
                            <misControles:InputTextBox Text="{Binding DatoFactura.OrdenCompra, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" MaxLength="50"
                                                        Visibility="{Binding DatoFactura.RequiereOrdenCompra, Converter={StaticResource BoolToVisibilityConverter}}"/>
                            <misControles:HeaderTextBlock Text="Semana" />
                            <misControles:InputTextBox Text="{Binding DatoFactura.Semana, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" MaxLength="10"/>
                            <misControles:HeaderTextBlock Text="# Exoneración DEI" 
                                                          Visibility="{Binding DatoFactura.RequiereOrdenCompra, Converter={StaticResource BoolToVisibilityConverter}}"/>
                            <misControles:InputTextBox Text="{Binding DatoFactura.ExonerationNo, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                                       Visibility="{Binding DatoFactura.RequiereOrdenCompra, Converter={StaticResource BoolToVisibilityConverter}}"
                                                       MaxLength="50"/>
                            <misControles:HeaderTextBlock Text="ISV %" Visibility="{Binding DatoFactura.IsExonerated, ConverterParameter=INVERTIR, Converter={StaticResource BoolToVisibilityConverter}}" />
                            <misControles:InputTextBox Text="{Binding DatoFactura.TaxPercent, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged, StringFormat=n2}" 
                                                       Visibility="{Binding DatoFactura.IsExonerated, ConverterParameter=INVERTIR, Converter={StaticResource BoolToVisibilityConverter}}" 
                                                       MaxLength="5"/>
                            <misControles:HeaderTextBlock Text="Total" />
                            <misControles:InputTextBox Text="{Binding DatoFactura.Total, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged, StringFormat=n2}" MaxLength="16"/>
                            <CheckBox Margin="5" IsChecked="{Binding DatoFactura.IsForeignCurrency, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}">Es Pago en $?</CheckBox>
                            <misControles:HeaderTextBlock Text="Total Lps" Visibility="{Binding DatoFactura.IsForeignCurrency, Converter={StaticResource BoolToVisibilityConverter}}"/>
                            <misControles:InputTextBox Text="{Binding DatoFactura.LocalCurrencyAmount, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged, StringFormat=n2}" 
                                                       MaxLength="16" Visibility="{Binding DatoFactura.IsForeignCurrency, Converter={StaticResource BoolToVisibilityConverter}}"/>
                            <misControles:HeaderTextBlock Text="Fecha Creación" />
                            <DatePicker Margin="5" SelectedDate="{Binding DatoFactura.Fecha, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>
                            <misControles:HeaderTextBlock Text="Comentarios" />
                            <misControles:InputTextBox Height="100" Text="{Binding DatoFactura.Observaciones, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                                   MaxLength="100"/>
                        </StackPanel>
                    </ScrollViewer>
                    <misControles:AppBarPanel Grid.Row="1" Background="{DynamicResource AccentColorBrush}">
                        <misControles:AppBarButton
                            Command="{Binding ComandoCrearFactura}"
                            Imagen="{DynamicResource GuardarPathImagen}"
                            Titulo="Guardar" />
                    </misControles:AppBarPanel>
                    <Border Grid.RowSpan="2" Visibility="{Binding MostrarVentanaEspera}">
                        <Grid>
                            <misControles:BloqueoPanel/>
                            <controlsMahApps:ProgressRing IsActive="True" IsLarge="False"/>
                        </Grid>
                    </Border>
                </Grid>
            </controlsMahApps:Flyout>
            <controlsMahApps:Flyout x:Name="EditarFacturaFlyout"
                Width="420"                
                Margin="100,0,0,0"
                Header="Editar Factura"
                IsModal="True"
                Position="Right"
                Theme="Adapt">
                <Grid Margin="10">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="*" />
                        <RowDefinition Height="70" />
                    </Grid.RowDefinitions>
                    <ScrollViewer Grid.Row="0" VerticalScrollBarVisibility="Auto">
                        <StackPanel Orientation="Vertical">
                            <misControles:HeaderTextBlock Text="Empresa Destino" />
                            <misControles:BodyTextBlock Text="{Binding DatoFactura.NombreSucursal, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />
                            <misControles:HeaderTextBlock Text="Planta Origen" />
                            <misControles:InputTextBoxAutoCompleteControl
                                    AutoCompletionList="{Binding ListaPlantasAutoComplete}"       
                                    Buscar="{Binding ComandoBuscarPlantas}"
                                    SelectedItem="{Binding PlantaAutoCompleteSeleccionada, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />
                            <misControles:HeaderTextBlock Text="SubPlanta" Visibility="{Binding Planta.HasSubPlanta, Converter={StaticResource BoolToVisibilityConverter}}"/>
                            <misControles:InputTextBoxAutoCompleteControl
                                    AutoCompletionList="{Binding SubPlantas}"       
                                    Buscar="{Binding CommandSearchSubPlantas}"
                                    SelectedItem="{Binding SubPlantaSelected, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" 
                                    Visibility="{Binding Planta.HasSubPlanta, Converter={StaticResource BoolToVisibilityConverter}}"/>
                            <misControles:HeaderTextBlock Text="Número de Factura" />
                            <misControles:InputTextBox Text="{Binding DatoFactura.NumeroFactura, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" MaxLength="10"/>
                            <CheckBox Margin="5" IsChecked="{Binding DatoFactura.HasUnitPriceItem, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}">La Factura contiene precio unitario por boleta?</CheckBox>
                            <misControles:HeaderTextBlock Grid.Column="0" Text="Tipo de Factura" />
                            <ComboBox
                                        Margin="5"
                                        Grid.Row="1"
                                        Grid.Column="0"
                                        DisplayMemberPath="Descripcion"
                                        ItemsSource="{Binding ListaFacturaCategorias}"
                                        SelectedItem="{Binding FacturaCategoriaSeleccionada, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                        SelectedValue="{Binding DatoFactura.FacturaCategoriaId, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                        SelectedValuePath="FacturaCategoriaId" />
                            <misControles:HeaderTextBlock Text="#PO" 
                                                          Visibility="{Binding DatoFactura.RequiereOrdenCompra, Converter={StaticResource BoolToVisibilityConverter}}"/>
                            <misControles:InputTextBox Text="{Binding DatoFactura.OrdenCompra, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" MaxLength="50"
                                                        Visibility="{Binding DatoFactura.RequiereOrdenCompra, Converter={StaticResource BoolToVisibilityConverter}}"/>
                            <misControles:HeaderTextBlock Text="Semana" />
                            <misControles:InputTextBox Text="{Binding DatoFactura.Semana, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" MaxLength="10"/>
                            <misControles:HeaderTextBlock Text="# Exoneración DEI" 
                                                          Visibility="{Binding DatoFactura.RequiereOrdenCompra, Converter={StaticResource BoolToVisibilityConverter}}"/>
                            <misControles:InputTextBox Text="{Binding DatoFactura.ExonerationNo, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                                       Visibility="{Binding DatoFactura.RequiereOrdenCompra, Converter={StaticResource BoolToVisibilityConverter}}"
                                                       MaxLength="50"/>
                            <misControles:HeaderTextBlock Text="ISV %" Visibility="{Binding DatoFactura.IsExonerated, ConverterParameter=INVERTIR, Converter={StaticResource BoolToVisibilityConverter}}" />
                            <misControles:InputTextBox Text="{Binding DatoFactura.TaxPercent, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged, StringFormat=n2}" 
                                                       Visibility="{Binding DatoFactura.IsExonerated, ConverterParameter=INVERTIR, Converter={StaticResource BoolToVisibilityConverter}}" 
                                                       MaxLength="5"/>
                            <misControles:HeaderTextBlock Text="Total" />
                            <misControles:InputTextBox Text="{Binding DatoFactura.Total, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged, StringFormat=n2}" MaxLength="16"/>
                            <CheckBox Margin="5" IsChecked="{Binding DatoFactura.IsForeignCurrency, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}">Es Pago en $?</CheckBox>
                            <misControles:HeaderTextBlock Text="Total Lps" Visibility="{Binding DatoFactura.IsForeignCurrency, Converter={StaticResource BoolToVisibilityConverter}}"/>
                            <misControles:InputTextBox Text="{Binding DatoFactura.LocalCurrencyAmount, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged, StringFormat=n2}" 
                                                       MaxLength="16" Visibility="{Binding DatoFactura.IsForeignCurrency, Converter={StaticResource BoolToVisibilityConverter}}"/>
                            <misControles:HeaderTextBlock Text="Fecha Creación" />
                            <DatePicker Margin="5" SelectedDate="{Binding DatoFactura.Fecha, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>
                            <misControles:HeaderTextBlock Text="Comentarios" />
                            <misControles:InputTextBox Height="100" Text="{Binding DatoFactura.Observaciones, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                                   MaxLength="100"/>
                        </StackPanel>
                    </ScrollViewer>
                    <misControles:AppBarPanel Grid.Row="1" Background="{DynamicResource AccentColorBrush}">
                        <misControles:AppBarButton
                            Command="{Binding CommandEditInvoiceInfo}"
                            Imagen="{DynamicResource GuardarPathImagen}"
                            Titulo="Guardar" />
                    </misControles:AppBarPanel>
                    <Border Grid.RowSpan="2" Visibility="{Binding MostrarVentanaEspera}">
                        <Grid>
                            <misControles:BloqueoPanel/>
                            <controlsMahApps:ProgressRing IsActive="True" IsLarge="False"/>
                        </Grid>
                    </Border>
                </Grid>
            </controlsMahApps:Flyout>
            <controlsMahApps:Flyout x:Name="AgregarFacturaBoletasFlyout"
                Width="700"
                Margin="100,0,0,0"
                Header="Agregar Factura Boletas"
                IsModal="True"
                Position="Right"
                Theme="Adapt">
                <Grid Margin="10">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="*" />
                        <RowDefinition Height="70" />
                    </Grid.RowDefinitions>
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto" MinHeight="30" />
                            <RowDefinition />
                        </Grid.RowDefinitions>
                        <Grid Grid.Row="0">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition  />
                                <ColumnDefinition  />
                            </Grid.ColumnDefinitions>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto" MinHeight="30" />
                                <RowDefinition Height="Auto" MinHeight="30" />
                            </Grid.RowDefinitions>
                            <misControles:HeaderTextBlock Text="Número Factura" HorizontalAlignment="Center" FontWeight="SemiBold"/>
                            <misControles:BodyTextBlock Grid.Row="1" Text="{Binding FacturaSeleccionada.NumeroFactura}" HorizontalAlignment="Center" />
                            <misControles:HeaderTextBlock Text="Planta Origen" Grid.Column="1" HorizontalAlignment="Center" FontWeight="SemiBold"/>
                            <misControles:BodyTextBlock Grid.Row="1" Grid.Column="1" Text="{Binding FacturaSeleccionada.NombrePlanta}" HorizontalAlignment="Center" />
                        </Grid>
                        <TabControl Grid.Row="1">
                            <TabItem HelpersMahApps:ControlsHelper.HeaderFontSize="16" Header="Agregar Boleta Manual">
                                <i:Interaction.Triggers>
                                    <i:EventTrigger EventName="PreviewMouseLeftButtonDown">
                                        <i:InvokeCommandAction Command="{Binding Path=ComandoIndicarTipoImportacion}" CommandParameter="True"/>
                                    </i:EventTrigger>
                                </i:Interaction.Triggers>
                                <Grid Margin="5">
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto" />
                                        <RowDefinition />
                                        <RowDefinition Height="Auto" />
                                    </Grid.RowDefinitions>
                                    <Grid Grid.Row="0">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="Auto" />
                                            <ColumnDefinition Width="250"/>
                                            <ColumnDefinition Width="Auto" />
                                        </Grid.ColumnDefinitions>
                                        <Grid.RowDefinitions>
                                            <RowDefinition Height="Auto" />
                                        </Grid.RowDefinitions>
                                        <misControles:HeaderTextBlock Grid.Row="0" Text="Codigo Boleta" />
                                        <misControles:InputTextBoxAutoCompleteControl
                                        Grid.Row="0"
                                        Grid.Column="1"
                                    AutoCompletionList="{Binding ListaBoletasAutoComplete}"       
                                    Buscar="{Binding ComandoBuscarBoletas}"
                                    SelectedItem="{Binding BoletaAutoCompleteSeleccionada, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />
                                        <misControles:OnlyImageAutoSizeButton
                                        Grid.Row="0"
                                        Grid.Column="2"
                                        Width="21"
                                        Height="21"
                                        Margin="5"
                                        HorizontalAlignment="Left"
                                        Background="{DynamicResource AccentColorBrush}"
                                        Command="{Binding ComandoAgregarFacturaBoletaDetalle}"
                                        Imagen="{DynamicResource AgregarPathImagen}" />
                                    </Grid>
                                    <DataGrid
                                        Grid.Row="1"
                                        Margin="5"
                                        AutoGenerateColumns="False"
                                        CanUserAddRows="False"
                                        CanUserDeleteRows="False"
                                        IsReadOnly="True"
                                        ItemsSource="{Binding ListaFacturaDetalleBoletasModel, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                        SelectedItem="{Binding FacturaDetalleBoletaSeleccionado, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}">
                                        <DataGrid.Columns>
                                            <DataGridTemplateColumn Width="33">
                                                <DataGridTemplateColumn.CellTemplate>
                                                    <DataTemplate>
                                                        <StackPanel Orientation="Horizontal">
                                                            <misControles:OnlyImageAutoSizeButton
                                                                Width="21"
                                                                Height="21"
                                                                Margin="2"
                                                                Background="{DynamicResource AccentColorBrush}"
                                                                Command="{Binding FacturasViewModel.ComandoQuitarFacturaBoletaDetalle, Source={StaticResource Locator}}"
                                                                Imagen="{DynamicResource QuitarPathImagen}" />
                                                        </StackPanel>
                                                    </DataTemplate>
                                                </DataGridTemplateColumn.CellTemplate>
                                            </DataGridTemplateColumn>
                                            <DataGridTextColumn Binding="{Binding CodigoBoleta}" Header="Boleta" />
                                            <DataGridTextColumn Binding="{Binding NombreProveedor}" Header="Proveedor" />
                                            <DataGridTextColumn Binding="{Binding DescripcionTipoProducto}" Header="Producto" />
                                            <DataGridTextColumn Binding="{Binding PrecioProductoCompra, StringFormat=N2}" Header="Precio Compra" />
                                            <DataGridTextColumn Binding="{Binding PrecioVenta, StringFormat=N2}" Header="Precio Venta" />
                                            <DataGridTextColumn Binding="{Binding PesoProducto, StringFormat=N2}" Header="Toneladas" />
                                            <DataGridTextColumn Binding="{Binding TotalPrecioBoleta, StringFormat=N2}" Header="Total" />
                                        </DataGrid.Columns>
                                    </DataGrid>
                                    <StackPanel Grid.Row="2" Orientation="Horizontal" HorizontalAlignment="Right">
                                        <misControles:HeaderTextBlock Text="Total:" FontWeight="Bold" FontSize="14" />
                                        <misControles:BodyTextBlock Text="{Binding DatoFacturaDetalleBoleta.TotalPago, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged, StringFormat=N2}"
                                                                    FontWeight="Bold" Foreground="Green" FontSize="14"/>
                                    </StackPanel>
                                </Grid>
                            </TabItem>
                            <TabItem HelpersMahApps:ControlsHelper.HeaderFontSize="16" Header="Importar Boletas">
                                <i:Interaction.Triggers>
                                    <i:EventTrigger EventName="PreviewMouseLeftButtonDown">
                                        <i:InvokeCommandAction Command="{Binding Path=ComandoIndicarTipoImportacion}" CommandParameter="False"/>
                                    </i:EventTrigger>
                                </i:Interaction.Triggers>
                                <Grid>
                                    <controles:ImportarExcelUserControl ColeccionDatosImportados="{Binding XlsColeccionImportacion, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />
                                </Grid>
                            </TabItem>
                            <TabItem HelpersMahApps:ControlsHelper.HeaderFontSize="16" Header="Validaciones" 
                                     Visibility="{Binding ImportacionErrores, Converter={StaticResource BoolToVisibilityConverter}}">
                                <Grid Margin="5">
                                    <DataGrid
                                        Grid.Row="1"
                                        Margin="5"
                                        AutoGenerateColumns="False"
                                        CanUserAddRows="False"
                                        CanUserDeleteRows="False"
                                        IsReadOnly="True"
                                        ItemsSource="{Binding ListaValidacionBoletas, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}">
                                        <DataGrid.Columns>
                                            <DataGridTemplateColumn Header="CodigoBoleta" Visibility="{Binding FacturaSeleccionada.ShippingNumberRequired, ConverterParameter=INVERTIR, Converter={StaticResource BoolToVisibilityConverter}}">
                                                <DataGridTemplateColumn.CellTemplate>
                                                    <DataTemplate>
                                                        <TextBlock Text="{Binding CodigoBoleta}"/>
                                                    </DataTemplate>
                                                </DataGridTemplateColumn.CellTemplate>
                                            </DataGridTemplateColumn>
                                            <DataGridTemplateColumn Header="#Envío" Visibility="{Binding FacturaSeleccionada.ShippingNumberRequired, Converter={StaticResource BoolToVisibilityConverter}}">
                                                <DataGridTemplateColumn.CellTemplate>
                                                    <DataTemplate>
                                                        <TextBlock Text="{Binding NumeroEnvio}"/>
                                                    </DataTemplate>
                                                </DataGridTemplateColumn.CellTemplate>
                                            </DataGridTemplateColumn>
                                            <DataGridTextColumn Binding="{Binding ValidationErrorMessage}" Header="MensajeValidacion" Foreground="Red" />
                                        </DataGrid.Columns>
                                    </DataGrid>
                                </Grid>
                            </TabItem>
                        </TabControl>
                    </Grid>
                    <misControles:AppBarPanel x:Name="GuardarManual" Grid.Row="1" Background="{DynamicResource AccentColorBrush}"
                                              Visibility="{Binding EsImportacionManual, Converter={StaticResource BoolToVisibilityConverter}}">
                        <misControles:AppBarButton
                            Command="{Binding ComandoGuardarDetalleBoletasManual}"
                            Imagen="{DynamicResource GuardarPathImagen}"
                            Titulo="Guardar" />
                    </misControles:AppBarPanel>
                    <misControles:AppBarPanel x:Name="GuardarMasivo" Grid.Row="1" Background="{DynamicResource AccentColorBrush}"
                                              Visibility="{Binding EsImportacionManual, Converter={StaticResource BoolToVisibilityConverter},ConverterParameter=INVERTIR}">
                        <misControles:AppBarButton
                            Command="{Binding ComandoGuardarDetalleBoletasMasivo}"
                            Imagen="{DynamicResource GuardarPathImagen}"
                            Titulo="Guardar Masivo" />
                    </misControles:AppBarPanel>
                    <Border Grid.RowSpan="2" Visibility="{Binding MostrarVentanaEspera}">
                        <Grid>
                            <misControles:BloqueoPanel/>
                            <controlsMahApps:ProgressRing IsActive="True" IsLarge="False"/>
                        </Grid>
                    </Border>
                </Grid>
            </controlsMahApps:Flyout>
            <controlsMahApps:Flyout x:Name="BoletasPendientesFacturarFlyout"
                Width="700"
                Margin="100,0,0,0"
                Header="Boletas Pendientes de Facturar"
                IsModal="True"
                Position="Right"
                Theme="Adapt">
                <Grid Margin="10">
                    <Grid.RowDefinitions>
                        <RowDefinition />
                        <RowDefinition Height="40"/>
                    </Grid.RowDefinitions>
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition />
                        </Grid.RowDefinitions>
                        <Grid Grid.Row="0">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition  />
                                <ColumnDefinition  />
                            </Grid.ColumnDefinitions>
                        </Grid>
                        <TabControl Grid.Row="1">
                            <TabItem HelpersMahApps:ControlsHelper.HeaderFontSize="16" Header="Buscar Boletas">
                                <Grid Margin="5">
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto" />
                                        <RowDefinition />
                                        <RowDefinition Height="Auto" />
                                    </Grid.RowDefinitions>
                                    <Grid Grid.Row="0">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="Auto" />
                                            <ColumnDefinition Width="250"/>
                                        </Grid.ColumnDefinitions>
                                        <Grid.RowDefinitions>
                                            <RowDefinition Height="Auto" />
                                        </Grid.RowDefinitions>
                                        <misControles:HeaderTextBlock Grid.Row="0" Text="Planta Origen" />
                                        <misControles:InputTextBoxAutoCompleteControl
                                        Grid.Row="0"
                                        Grid.Column="1"
                                    AutoCompletionList="{Binding ListaPlantasAutoComplete}"       
                                    Buscar="{Binding ComandoBuscarPlantas}"
                                    SelectedItem="{Binding PlantaAutoCompleteSeleccionada, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />
                                    </Grid>
                                    <DataGrid
                                        Grid.Row="1"
                                        Margin="5"
                                        AutoGenerateColumns="False"
                                        CanUserAddRows="False"
                                        CanUserDeleteRows="False"
                                        IsReadOnly="True"
                                        ItemsSource="{Binding ListaBoletasPorFacturar, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}">
                                        <DataGrid.Columns>
                                            <DataGridTextColumn Binding="{Binding CodigoBoleta}" Header="Boleta" />
                                            <DataGridTextColumn Binding="{Binding DescripcionTipoProducto}" Header="Producto" />
                                            <DataGridTextColumn Binding="{Binding PesoProducto}" Header="Peso" />
                                            <DataGridTextColumn Binding="{Binding PrecioProductoCompra, StringFormat=N2}" Header="Precio Compra" />
                                            <DataGridTextColumn Binding="{Binding PrecioVenta, StringFormat=N2}" Header="Precio Venta" />
                                            <DataGridTextColumn Binding="{Binding TotalFacturaVenta, StringFormat=N2}" Header="Total" />
                                            <DataGridTextColumn Binding="{Binding FechaSalida, StringFormat=d}" Header="Fecha" />
                                        </DataGrid.Columns>
                                    </DataGrid>
                                    <StackPanel Grid.Row="2" Orientation="Horizontal" HorizontalAlignment="Right">
                                        <misControles:HeaderTextBlock Text="Total:" FontWeight="Bold" FontSize="14" />
                                        <misControles:BodyTextBlock Text="{Binding TotalBoletasPendienteFacturar, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged, StringFormat=N2}" FontWeight="Bold" Foreground="Red" FontSize="14" />
                                    </StackPanel>
                                </Grid>
                            </TabItem>
                        </TabControl>
                    </Grid>
                    <misControles:AppBarPanel Grid.Row="1" Background="{DynamicResource AccentColorBrush}">
                    </misControles:AppBarPanel>
                    <Border Grid.RowSpan="2" Visibility="{Binding MostrarVentanaEspera}">
                        <Grid>
                            <misControles:BloqueoPanel/>
                            <controlsMahApps:ProgressRing IsActive="True" IsLarge="False"/>
                        </Grid>
                    </Border>
                </Grid>
            </controlsMahApps:Flyout>
            <controlsMahApps:Flyout x:Name="InvoiceDetailItemsFlyout"
                Width="650"
                Margin="100,0,0,0"
                Header="Factura Detalle Items"
                IsModal="True"
                Position="Right"
                Theme="Adapt">
                <Grid Margin="10">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="*" />
                        <RowDefinition Height="70" />
                    </Grid.RowDefinitions>
                    <Grid Grid.Row="0">
                        <GroupBox Header="Factura Encabezado">
                            <Grid>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto" />
                                </Grid.RowDefinitions>
                                <Grid Grid.Row="0">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition />
                                        <ColumnDefinition />
                                        <ColumnDefinition />
                                        <ColumnDefinition />
                                        <ColumnDefinition />
                                    </Grid.ColumnDefinitions>
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto" MinHeight="30" />
                                        <RowDefinition Height="Auto" MinHeight="30" />
                                    </Grid.RowDefinitions>
                                    <misControles:HeaderTextBlock Grid.Column="0" Text="Factura" 
                                                              FontWeight="SemiBold"
                                                              HorizontalAlignment="Center"/>
                                    <misControles:BodyTextBlock Grid.Row="1" Grid.Column="0" 
                                                                Text="{Binding FacturaSeleccionada.NumeroFactura, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" 
                                                                HorizontalAlignment="Stretch"/>
                                    <misControles:HeaderTextBlock Grid.Column="1" Text="Planta" 
                                                              FontWeight="SemiBold"
                                                              HorizontalAlignment="Center"/>
                                    <misControles:BodyTextBlock Grid.Row="1" Grid.Column="1" 
                                                                Text="{Binding FacturaSeleccionada.NombrePlanta, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                                                HorizontalAlignment="Stretch"/>
                                    <misControles:HeaderTextBlock
                                        Grid.Row="0"
                                        Grid.Column="2"
                                        Text="SubTotal" 
                                        FontWeight="SemiBold"
                                        HorizontalAlignment="Center"/>
                                    <misControles:BodyTextBlock Grid.Row="1" Grid.Column="2" 
                                                                FontSize="12"
                                                                FontWeight="Bold"
                                                                Text="{Binding InvoiceDetailItemDato.SubTotal,
                                                                Mode=TwoWay, UpdateSourceTrigger=PropertyChanged, StringFormat=N2}"
                                                                HorizontalAlignment="Stretch"/>
                                    <misControles:HeaderTextBlock
                                        Grid.Row="0"
                                        Grid.Column="3"
                                        Text="ISV" 
                                        FontWeight="SemiBold"
                                        HorizontalAlignment="Center"/>
                                    <misControles:BodyTextBlock Grid.Row="1" Grid.Column="3" 
                                                                FontSize="12"
                                                                FontWeight="Bold"
                                                                Text="{Binding InvoiceDetailItemDato.Tax,
                                                                Mode=TwoWay, UpdateSourceTrigger=PropertyChanged, StringFormat=N2}" 
                                                                HorizontalAlignment="Stretch"/>
                                    <misControles:HeaderTextBlock
                                        Grid.Row="0"
                                        Grid.Column="4"
                                        Text="Total" 
                                        FontWeight="SemiBold"
                                        HorizontalAlignment="Center"/>
                                    <misControles:BodyTextBlock Grid.Row="1" Grid.Column="4" 
                                                                FontSize="12"
                                                                FontWeight="Bold"
                                                                Text="{Binding InvoiceDetailItemDato.Total,
                                                                Mode=TwoWay, UpdateSourceTrigger=PropertyChanged, StringFormat=N2}" 
                                                                HorizontalAlignment="Stretch"/>
                                </Grid>
                            </Grid>
                        </GroupBox>
                    </Grid>
                    <Grid Grid.Row="1">
                        <GroupBox Header="DETALLE ITEMS">
                            <Grid>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto" />
                                    <RowDefinition Height="*" />
                                </Grid.RowDefinitions>
                                <Grid Grid.Row="0">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width= "85" />
                                        <ColumnDefinition Width="*" />
                                        <ColumnDefinition Width="*" />
                                        <ColumnDefinition Width="85" />
                                        <ColumnDefinition Width="40"/>
                                    </Grid.ColumnDefinitions>
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto" MinHeight="30" />
                                        <RowDefinition Height="Auto" MinHeight="30" />
                                    </Grid.RowDefinitions>
                                    <misControles:HeaderTextBlock Grid.Column="0" Text="Cantidad" 
                                                              FontWeight="SemiBold"
                                                              TextAlignment="Center"/>
                                    <misControles:InputTextBox Grid.Row="1" Grid.Column="0" 
                                                               Text="{Binding InvoiceDetailItemDato.Cantidad, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged, StringFormat=n2}"
                                                               MaxLength="16"
                                                               VerticalAlignment="Center"/>
                                    <misControles:HeaderTextBlock Grid.Column="1" Grid.ColumnSpan="2" Text="Descripción" 
                                                              FontWeight="SemiBold"
                                                              TextAlignment="Center"/>
                                    <misControles:InputTextBoxAutoCompleteControl
                                    Grid.Row="1"
                                    Grid.ColumnSpan="2"
                                    Grid.Column="1"
                                    AutoCompletionList="{Binding ProductItems}"
                                    Buscar="{Binding CommandSearchProductItem}"
                                    SelectedItem="{Binding ProductItemSelected, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                    VerticalAlignment="Center"/>
                                    <misControles:HeaderTextBlock Grid.Column="3" Text="Precio" 
                                                              FontWeight="SemiBold"
                                                              TextAlignment="Center"/>
                                    <misControles:InputTextBox Grid.Row="1" Grid.Column="3" 
                                                               Text="{Binding InvoiceDetailItemDato.Precio, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged, StringFormat=n2}"
                                                               MaxLength="16"
                                                               VerticalAlignment="Center"/>
                                    <misControles:OnlyImageAutoSizeButton
                                        Grid.Row="1"
                                        Grid.Column="4"
                                        Width="21"
                                        Height="21"
                                        Margin="5"
                                        HorizontalAlignment="Left"
                                        Background="{DynamicResource AccentColorBrush}"
                                        Command="{Binding CommandAddInvoiceDetailItem}"
                                        Imagen="{DynamicResource AgregarPathImagen}" />
                                </Grid>
                                <Grid Grid.Row="1">
                                    <DataGrid                                    
                                Margin="5"
                                AutoGenerateColumns="False"
                                CanUserAddRows="False"
                                CanUserDeleteRows="False"
                                IsReadOnly="True"                                        
                                ItemsSource="{Binding InvoiceDetailItemsModel, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                SelectedItem="{Binding InvoiceDetailItemSelected, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}">
                                        <DataGrid.Columns>
                                            <DataGridTemplateColumn Width="55">
                                                <DataGridTemplateColumn.CellTemplate>
                                                    <DataTemplate>
                                                        <StackPanel Orientation="Horizontal">
                                                            <misControles:OnlyImageAutoSizeButton
                                                        Width="21"
                                                        Height="21"
                                                        Margin="2"
                                                        Background="{DynamicResource AccentColorBrush}"
                                                        Command="{Binding FacturasViewModel.CommandRemoveInvoiceDetailItem, Source={StaticResource Locator}}"
                                                        Imagen="{DynamicResource QuitarPathImagen}" />
                                                            <misControles:OnlyImageAutoSizeButton
                                                        Width="21"
                                                        Height="21"
                                                        Margin="2"
                                                        Background="{DynamicResource AccentColorBrush}"
                                                        Command="{Binding FacturasViewModel.CommandEditInvoiceDetailItem, Source={StaticResource Locator}}"
                                                        Imagen="{DynamicResource EditarPathImagen}" />
                                                        </StackPanel>
                                                    </DataTemplate>
                                                </DataGridTemplateColumn.CellTemplate>
                                            </DataGridTemplateColumn>
                                            <DataGridTextColumn Binding="{Binding Cantidad, StringFormat=N2}" Header="Cantidad" />
                                            <DataGridTextColumn Binding="{Binding ProductoDescripcion}" Header="Descripción" />
                                            <DataGridTemplateColumn Header="Precio">
                                                <DataGridTemplateColumn.CellTemplate>
                                                    <DataTemplate>
                                                        <TextBlock Text="{Binding Precio, StringFormat=N2}" HorizontalAlignment="Center"/>
                                                    </DataTemplate>
                                                </DataGridTemplateColumn.CellTemplate>
                                            </DataGridTemplateColumn>
                                            <DataGridTemplateColumn Header="$">
                                                <DataGridTemplateColumn.CellTemplate>
                                                    <DataTemplate>
                                                        <TextBlock Text="{Binding ForeignCurrencyAmount, StringFormat=N2}" HorizontalAlignment="Right"/>
                                                    </DataTemplate>
                                                </DataGridTemplateColumn.CellTemplate>
                                            </DataGridTemplateColumn>
                                            <DataGridTemplateColumn Header="Lps">
                                                <DataGridTemplateColumn.CellTemplate>
                                                    <DataTemplate>
                                                        <TextBlock Text="{Binding LocalCurrencyAmount, StringFormat=N2}" HorizontalAlignment="Right"/>
                                                    </DataTemplate>
                                                </DataGridTemplateColumn.CellTemplate>
                                            </DataGridTemplateColumn>
                                        </DataGrid.Columns>
                                    </DataGrid>
                                </Grid>
                            </Grid>
                        </GroupBox>
                    </Grid>
                    <misControles:AppBarPanel Grid.Row="2" Background="{DynamicResource AccentColorBrush}">
                        <misControles:AppBarButton
                            Command="{Binding CommandSaveInvoiceDetailItems}"
                            Imagen="{DynamicResource GuardarPathImagen}"
                            Titulo="Guardar" />
                    </misControles:AppBarPanel>
                    <Border Grid.RowSpan="3" Visibility="{Binding MostrarVentanaEspera}">
                        <Grid>
                            <misControles:BloqueoPanel/>
                            <controlsMahApps:ProgressRing IsActive="True" IsLarge="False"/>
                        </Grid>
                    </Border>
                </Grid>
            </controlsMahApps:Flyout>
            <controlsMahApps:Flyout x:Name="InvoicePaymentFlyout"
                Width="650"
                Margin="100,0,0,0"
                Header="Pagos de Factura"
                IsModal="True"
                Position="Right"
                Theme="Adapt">
                <Grid Margin="10">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="*" />
                        <RowDefinition Height="70" />
                    </Grid.RowDefinitions>
                    <Grid Grid.Row="0">
                        <GroupBox Header="PAGO DE FACTURA">
                            <Grid>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto" />
                                </Grid.RowDefinitions>
                                <Grid Grid.Row="0">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition />
                                        <ColumnDefinition />
                                        <ColumnDefinition />
                                        <ColumnDefinition />
                                    </Grid.ColumnDefinitions>
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto" MinHeight="30" />
                                        <RowDefinition Height="Auto" MinHeight="30" />
                                    </Grid.RowDefinitions>
                                    <misControles:HeaderTextBlock Grid.Column="0" Text="Número Factura" FontWeight="SemiBold" HorizontalAlignment="Center" />
                                    <misControles:BodyTextBlock Grid.Row="1" Grid.Column="0" 
                                                                Text="{Binding FacturaSeleccionada.NumeroFactura, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" HorizontalAlignment="Stretch"/>
                                    <misControles:HeaderTextBlock Grid.Column="1" Text="Planta" FontWeight="SemiBold" HorizontalAlignment="Center"/>
                                    <misControles:BodyTextBlock Grid.Row="1" Grid.Column="1" 
                                                                Text="{Binding InvoicePaymentDato.Planta, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" HorizontalAlignment="Stretch" />
                                    <misControles:HeaderTextBlock
                                        Grid.Row="0"
                                        Grid.Column="2"
                                        Text="Total $"
                                    FontWeight="SemiBold" HorizontalAlignment="Center"
                                        Visibility="{Binding FacturaSeleccionada.IsForeignCurrency, Converter={StaticResource BoolToVisibilityConverter}}"/>
                                    <misControles:BodyTextBlock Grid.Row="1" Grid.Column="2" 
                                                                FontSize="12"
                                                                FontWeight="Bold"
                                                                Text="{Binding FacturaSeleccionada.InvoiceForeignTotal,
                                                                Mode=TwoWay, UpdateSourceTrigger=PropertyChanged, StringFormat=N2}" HorizontalAlignment="Stretch"
                                                                Visibility="{Binding FacturaSeleccionada.IsForeignCurrency, Converter={StaticResource BoolToVisibilityConverter}}"/>
                                    <misControles:HeaderTextBlock
                                        Grid.Row="0"
                                        Grid.Column="2"
                                        Text="Total Lps"
                                    FontWeight="SemiBold" HorizontalAlignment="Center"
                                        Visibility="{Binding FacturaSeleccionada.IsForeignCurrency, ConverterParameter=INVERTIR, Converter={StaticResource BoolToVisibilityConverter}}"/>
                                    <misControles:BodyTextBlock Grid.Row="1" Grid.Column="2" 
                                                                FontSize="12"
                                                                FontWeight="Bold"
                                                                Text="{Binding FacturaSeleccionada.InvoiceLocalTotal,
                                                                Mode=TwoWay, UpdateSourceTrigger=PropertyChanged, StringFormat=N2}" HorizontalAlignment="Stretch"
                                                                Visibility="{Binding FacturaSeleccionada.IsForeignCurrency, ConverterParameter=INVERTIR, Converter={StaticResource BoolToVisibilityConverter}}"/>
                                    <misControles:HeaderTextBlock
                                        Grid.Row="0"
                                        Grid.Column="3"
                                        Text="Pago Registrado"
                                    FontWeight="SemiBold" HorizontalAlignment="Center"/>
                                    <misControles:BodyTextBlock Grid.Row="1" Grid.Column="3" 
                                                                FontSize="12"
                                                                FontWeight="Bold"
                                                                Text="{Binding InvoicePaymentDato.TotalPaid,
                                                                Mode=TwoWay, UpdateSourceTrigger=PropertyChanged, StringFormat=N2}" HorizontalAlignment="Stretch"/>
                                </Grid>
                            </Grid>
                        </GroupBox>
                    </Grid>
                    <Grid Grid.Row="1">
                        <GroupBox Header="TRANSACCIóN BANCARíA">
                            <Grid>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto" />
                                    <RowDefinition Height="*" />
                                </Grid.RowDefinitions>
                                <Grid Grid.Row="0">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition />
                                        <ColumnDefinition />
                                        <ColumnDefinition />
                                        <ColumnDefinition Width="40"/>
                                    </Grid.ColumnDefinitions>
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto" MinHeight="30" />
                                        <RowDefinition Height="Auto" MinHeight="30" />
                                        <RowDefinition Height="Auto" MinHeight="30" />
                                        <RowDefinition Height="Auto" MinHeight="30" />
                                    </Grid.RowDefinitions>
                                    <misControles:HeaderTextBlock Grid.Column="0" Text="Fecha de Pago"  Grid.Row="2"
                                                              FontWeight="SemiBold"
                                                              TextAlignment="Center"/>
                                    <DatePicker Margin="5" Grid.Column="0" Grid.Row="3" SelectedDate="{Binding InvoicePaymentDato.FechaDePago, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>
                                    <misControles:HeaderTextBlock Grid.Column="0" Grid.ColumnSpan="2" Text="Forma de Pago" 
                                                              FontWeight="SemiBold"
                                                              TextAlignment="Center"/>
                                    <ComboBox
                                        Margin="5"
                                        Grid.Row="1"
                                        Grid.Column="0"  
                                        Grid.ColumnSpan="2"
                                        ItemsSource="{Binding ListaFormaPagos}"
                                        DisplayMemberPath="Descripcion"
                                        SelectedItem="{Binding FormaDePagoSeleccionada, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                        SelectedValue="{Binding InvoicePaymentDato.FormaDePago, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" 
                                        SelectedValuePath="Descripcion"/>
                                    <misControles:HeaderTextBlock Grid.Column="2" Text="Banco" 
                                                              FontWeight="SemiBold"
                                                              TextAlignment="Center"/>
                                    <ComboBox
                                        Margin="5"
                                        Grid.Row="1"
                                        Grid.Column="2"
                                        ItemsSource="{Binding Banks}"
                                        DisplayMemberPath="Descripcion"                                        
                                        SelectedItem="{Binding BankSelected, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                        SelectedValue="{Binding InvoicePaymentDato.BancoId, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" 
                                        SelectedValuePath="BancoId"
                                        IsEnabled="{Binding FormaDePagoSeleccionada.RequiereBanco,Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>
                                    <misControles:HeaderTextBlock Grid.Column="1" Grid.Row="2" Text="Referencia Bancaria" TextAlignment="Center"
                                                              FontWeight="SemiBold"/>
                                    <misControles:InputTextBox Grid.Row="3" Grid.Column="1" 
                                                               Text="{Binding InvoicePaymentDato.ReferenciaBancaria, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                                               MaxLength="50"
                                                               IsEnabled="{Binding FormaDePagoSeleccionada.RequiereBanco,Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>
                                    <misControles:HeaderTextBlock Text="Monto"
                                                              Grid.Column="2" 
                                                              Grid.Row="2" 
                                                              TextAlignment="Center" 
                                                              FontWeight="SemiBold"/>
                                    <misControles:InputTextBox Grid.Row="3" Grid.Column="2"
                                                               FontSize="12"
                                                               FontWeight="Bold"
                                                               Text="{Binding InvoicePaymentDato.Monto, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged, StringFormat=N2}"
                                                               Comportamientos:TextBoxMaskBehavior.MaximumValue="18"/>
                                    <misControles:OnlyImageAutoSizeButton
                                        Grid.Row="2"
                                        Grid.Column="3"
                                        Width="21"
                                        Height="21"
                                        Margin="5"
                                        HorizontalAlignment="Left"
                                        Background="{DynamicResource AccentColorBrush}"
                                        Command="{Binding CommandAddInvoicePayItem}"
                                        Imagen="{DynamicResource AgregarPathImagen}" />
                                </Grid>
                                <Grid Grid.Row="1">
                                    <DataGrid                                    
                                Margin="5"
                                AutoGenerateColumns="False"
                                CanUserAddRows="False"
                                CanUserDeleteRows="False"
                                IsReadOnly="True"                                        
                                ItemsSource="{Binding InvoicePayments, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                SelectedItem="{Binding InvoicePaymentSelected, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}">
                                        <DataGrid.Columns>
                                            <DataGridTemplateColumn Width="55">
                                                <DataGridTemplateColumn.CellTemplate>
                                                    <DataTemplate>
                                                        <StackPanel Orientation="Horizontal">
                                                            <misControles:OnlyImageAutoSizeButton
                                                        Width="21"
                                                        Height="21"
                                                        Margin="2"
                                                        Background="{DynamicResource AccentColorBrush}"
                                                        Command="{Binding FacturasViewModel.CommandRemoveInvoicePayItem, Source={StaticResource Locator}}"
                                                        Imagen="{DynamicResource QuitarPathImagen}" />
                                                            <misControles:OnlyImageAutoSizeButton
                                                        Width="21"
                                                        Height="21"
                                                        Margin="2"
                                                        Background="{DynamicResource AccentColorBrush}"
                                                        Command="{Binding FacturasViewModel.CommandEditInvoicePayItem, Source={StaticResource Locator}}"
                                                        Imagen="{DynamicResource EditarPathImagen}"
                                                                IsEnabled="False"/>
                                                        </StackPanel>
                                                    </DataTemplate>
                                                </DataGridTemplateColumn.CellTemplate>
                                            </DataGridTemplateColumn>
                                            <DataGridTextColumn Binding="{Binding FechaDePago, StringFormat=d}" Header="Fecha Pago" />
                                            <DataGridTextColumn Binding="{Binding FormaDePago}" Header="Forma Pago" />
                                            <DataGridTextColumn Binding="{Binding Monto, StringFormat=N2}" Header="Monto" />
                                            <DataGridTextColumn Binding="{Binding NombreBanco}" Header="Banco" />
                                            <DataGridTextColumn Binding="{Binding ReferenciaBancaria}" Header="Ref" />
                                        </DataGrid.Columns>
                                    </DataGrid>
                                </Grid>
                            </Grid>
                        </GroupBox>
                    </Grid>
                    <misControles:AppBarPanel Grid.Row="2" Background="{DynamicResource AccentColorBrush}">
                        <misControles:AppBarButton
                            Command="{Binding CommandSaveInvoicePayment}"
                            Imagen="{DynamicResource GuardarPathImagen}"
                            Titulo="Guardar" />
                    </misControles:AppBarPanel>
                    <Border Grid.RowSpan="3" Visibility="{Binding MostrarVentanaEspera}">
                        <Grid>
                            <misControles:BloqueoPanel/>
                            <controlsMahApps:ProgressRing IsActive="True" IsLarge="False"/>
                        </Grid>
                    </Border>
                </Grid>
            </controlsMahApps:Flyout>
            <controlsMahApps:Flyout x:Name="InvoiceNotasCreditoFlyout"
                Width="600"
                Margin="100,0,0,0"
                Header="Pagos de Factura"
                IsModal="True"
                Position="Right"
                Theme="Adapt">
                <Grid Margin="10">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="*" />
                        <RowDefinition Height="70" />
                    </Grid.RowDefinitions>
                    <Grid Grid.Row="0">
                        <GroupBox Header="DATOS DE FACTURA">
                            <Grid>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto" />
                                </Grid.RowDefinitions>
                                <Grid Grid.Row="0">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition />
                                        <ColumnDefinition />
                                        <ColumnDefinition />
                                        <ColumnDefinition />
                                    </Grid.ColumnDefinitions>
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto" MinHeight="30" />
                                        <RowDefinition Height="Auto" MinHeight="30" />
                                    </Grid.RowDefinitions>
                                    <misControles:HeaderTextBlock Grid.Column="0" Text="Número Factura" FontWeight="SemiBold" HorizontalAlignment="Center" />
                                    <misControles:BodyTextBlock Grid.Row="1" Grid.Column="0" 
                                                                Text="{Binding FacturaSeleccionada.NumeroFactura, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" HorizontalAlignment="Stretch"/>
                                    <misControles:HeaderTextBlock Grid.Column="1" Text="Planta" FontWeight="SemiBold" HorizontalAlignment="Center"/>
                                    <misControles:BodyTextBlock Grid.Row="1" Grid.Column="1" 
                                                                Text="{Binding FacturaSeleccionada.NombrePlanta, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" HorizontalAlignment="Stretch" />
                                    <misControles:HeaderTextBlock
                                        Grid.Row="0"
                                        Grid.Column="2"
                                        Text="Total $"
                                    FontWeight="SemiBold" HorizontalAlignment="Center"
                                        Visibility="{Binding FacturaSeleccionada.IsForeignCurrency, Converter={StaticResource BoolToVisibilityConverter}}"/>
                                    <misControles:BodyTextBlock Grid.Row="1" Grid.Column="2" 
                                                                FontSize="12"
                                                                FontWeight="Bold"
                                                                Text="{Binding FacturaSeleccionada.InvoiceForeignTotal,
                                                                Mode=TwoWay, UpdateSourceTrigger=PropertyChanged, StringFormat=N2}" HorizontalAlignment="Stretch"
                                                                Visibility="{Binding FacturaSeleccionada.IsForeignCurrency, Converter={StaticResource BoolToVisibilityConverter}}"/>
                                    <misControles:HeaderTextBlock
                                        Grid.Row="0"
                                        Grid.Column="2"
                                        Text="Total Lps"
                                    FontWeight="SemiBold" HorizontalAlignment="Center"
                                        Visibility="{Binding FacturaSeleccionada.IsForeignCurrency, ConverterParameter=INVERTIR, Converter={StaticResource BoolToVisibilityConverter}}"/>
                                    <misControles:BodyTextBlock Grid.Row="1" Grid.Column="2" 
                                                                FontSize="12"
                                                                FontWeight="Bold"
                                                                Text="{Binding FacturaSeleccionada.InvoiceLocalTotal,
                                                                Mode=TwoWay, UpdateSourceTrigger=PropertyChanged, StringFormat=N2}" HorizontalAlignment="Stretch"
                                                                Visibility="{Binding FacturaSeleccionada.IsForeignCurrency, ConverterParameter=INVERTIR, Converter={StaticResource BoolToVisibilityConverter}}"/>
                                    <misControles:HeaderTextBlock
                                        Grid.Row="0"
                                        Grid.Column="3"
                                        Text="Notas Crédito"
                                    FontWeight="SemiBold" HorizontalAlignment="Center"/>
                                    <misControles:BodyTextBlock Grid.Row="1" Grid.Column="3" 
                                                                FontSize="12"
                                                                FontWeight="Bold"
                                                                Text="{Binding NotaCreditoDato.TotalNotasCredito,
                                                                Mode=TwoWay, UpdateSourceTrigger=PropertyChanged, StringFormat=N2}" HorizontalAlignment="Stretch"/>
                                </Grid>
                            </Grid>
                        </GroupBox>
                    </Grid>
                    <Grid Grid.Row="1">
                        <GroupBox Header="Notas de Crédito">
                            <Grid>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto" />
                                    <RowDefinition Height="*" />
                                </Grid.RowDefinitions>
                                <Grid Grid.Row="0">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition />
                                        <ColumnDefinition />
                                        <ColumnDefinition Width="40"/>
                                    </Grid.ColumnDefinitions>
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto" MinHeight="30" />
                                        <RowDefinition Height="Auto" MinHeight="30" />
                                        <RowDefinition Height="Auto" MinHeight="30" />
                                        <RowDefinition Height="Auto" MinHeight="30" />
                                    </Grid.RowDefinitions>
                                    <misControles:HeaderTextBlock Grid.Column="0" Text="Observaciones"  Grid.Row="2"
                                                              FontWeight="SemiBold"
                                                              TextAlignment="Center"
                                                              Grid.ColumnSpan="2"/>
                                    <misControles:InputTextBox Grid.Row="3" Grid.Column="0" Grid.ColumnSpan="2"
                                                               FontSize="12"
                                                               FontWeight="Bold"
                                                           MaxLength="50"
                                                               Text="{Binding NotaCreditoDato.Observaciones, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>
                                    <misControles:HeaderTextBlock Grid.Column="0" Text="#Nota Crédito" 
                                                              FontWeight="SemiBold"
                                                              TextAlignment="Center"/>
                                    <misControles:InputTextBox
                                        Margin="5"
                                        Grid.Row="1"
                                        Grid.Column="0"  
                                        Text="{Binding NotaCreditoDato.NotaCreditoNo, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>
                                    <misControles:HeaderTextBlock Text="Monto"
                                                              Grid.Column="1" 
                                                              Grid.Row="0" 
                                                              TextAlignment="Center" 
                                                              FontWeight="SemiBold"/>
                                    <misControles:InputTextBox Grid.Row="1" Grid.Column="1"
                                                               FontSize="12"
                                                               FontWeight="Bold"
                                                               Text="{Binding NotaCreditoDato.Monto, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged, StringFormat=N2}"
                                                               Comportamientos:TextBoxMaskBehavior.MaximumValue="18"/>
                                    <misControles:OnlyImageAutoSizeButton
                                        Grid.Row="2"
                                        Grid.Column="2"
                                        Width="21"
                                        Height="21"
                                        Margin="5"
                                        HorizontalAlignment="Left"
                                        Background="{DynamicResource AccentColorBrush}"
                                        Command="{Binding CommandAddNotaCredito}"
                                        Imagen="{DynamicResource AgregarPathImagen}" />
                                </Grid>
                                <Grid Grid.Row="1">
                                    <DataGrid                                    
                                Margin="5"
                                AutoGenerateColumns="False"
                                CanUserAddRows="False"
                                CanUserDeleteRows="False"
                                IsReadOnly="True"                                        
                                ItemsSource="{Binding NotasCreditoModel, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                SelectedItem="{Binding NotaCreditoSelected, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}">
                                        <DataGrid.Columns>
                                            <DataGridTemplateColumn Width="26">
                                                <DataGridTemplateColumn.CellTemplate>
                                                    <DataTemplate>
                                                        <StackPanel Orientation="Horizontal">
                                                            <misControles:OnlyImageAutoSizeButton
                                                        Width="21"
                                                        Height="21"
                                                        Margin="2"
                                                        Background="{DynamicResource AccentColorBrush}"
                                                        Command="{Binding FacturasViewModel.CommandRemoveNotaCredito, Source={StaticResource Locator}}"
                                                        Imagen="{DynamicResource QuitarPathImagen}" />
                                                        </StackPanel>
                                                    </DataTemplate>
                                                </DataGridTemplateColumn.CellTemplate>
                                            </DataGridTemplateColumn>
                                            <DataGridTextColumn Binding="{Binding NotaCreditoNo}" Header="#Nota Crédito" />
                                            <DataGridTextColumn Binding="{Binding Monto, StringFormat=N2}" Header="Monto" />
                                            <DataGridTextColumn Binding="{Binding Observaciones}" Header="Observaciones" />
                                        </DataGrid.Columns>
                                    </DataGrid>
                                </Grid>
                            </Grid>
                        </GroupBox>
                    </Grid>
                    <misControles:AppBarPanel Grid.Row="2" Background="{DynamicResource AccentColorBrush}">
                        <misControles:AppBarButton
                            Command="{Binding CommandSaveNotasCredito}"
                            Imagen="{DynamicResource GuardarPathImagen}"
                            Titulo="Guardar" />
                    </misControles:AppBarPanel>
                    <Border Grid.RowSpan="3" Visibility="{Binding MostrarVentanaEspera}">
                        <Grid>
                            <misControles:BloqueoPanel/>
                            <controlsMahApps:ProgressRing IsActive="True" IsLarge="False"/>
                        </Grid>
                    </Border>
                </Grid>
            </controlsMahApps:Flyout>
        </controlsMahApps:FlyoutsControl>
    </wpfCoreWindow:MetroWindowExt.Flyouts>

    <Grid>
        <Grid x:Name="Facturaciones">
            <Grid.RowDefinitions>
                <RowDefinition />
                <RowDefinition Height="70" />
            </Grid.RowDefinitions>
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition />
                </Grid.RowDefinitions>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="275" />
                    <ColumnDefinition />
                </Grid.ColumnDefinitions>
                <GroupBox Header="Busqueda Facturas" Grid.Column="0">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="400*" />
                            <RowDefinition Height="33*" />
                        </Grid.RowDefinitions>
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto" />
                                <RowDefinition Height="Auto" />
                            </Grid.RowDefinitions>
                            <misControles:TitleTextBlock Text="Buscar" />
                            <misControles:SearchTextBox
							Grid.Row="1"
							Buscar="{Binding CommandSearchInvoice}"
							SpellCheck.IsEnabled="True"
							Text="{Binding ValorBusquedaFacturas, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />
                        </Grid>
                        <ListBox
                        Grid.Row="1"
                        Margin="5"
                        IsSynchronizedWithCurrentItem="True"
                        ItemsSource="{Binding BusquedaFacturasControl.Items}"
                        SelectedItem="{Binding FacturaSeleccionada, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}">
                            <ListBox.ItemTemplate>
                                <DataTemplate>
                                    <StackPanel Orientation="Horizontal">
                                        <Viewbox Margin="2">
                                            <Grid Width="25">
                                                <Path
                                                Fill="{Binding Estado, Converter={StaticResource StateValueToColorConverter}}"
                                                Data="M4,12.699987L11.700012,12.699987 11.700012,14.000005 4,14.000005z M27.799988,11.500004C27.900024,11.500004,27.900024,11.500004,27.900024,11.59998L27.799988,14.000005C27.799988,14.299993,27.599976,14.000005,27.599976,14.000005L27.299988,13.500005C26.200012,15.000005 24.5,16.000005 22.5,16.000005 20.200012,16.000005 18.200012,14.699987 17.299988,12.799993 17.200012,12.59998 17.099976,12.399998 17,12.199986 16.900024,11.500004 17.700012,11.399998 18,11.699986 18.099976,11.799992 18.299988,12.09998 18.400024,12.299992 19.200012,13.799993 20.700012,14.799993 22.5,14.799993 24.099976,14.799993 25.400024,14.000005 26.299988,12.799993L25.700012,12.699987C25.700012,12.699987,25.400024,12.699987,25.599976,12.500004z M4,9.500003L11.700012,9.500003 11.700012,10.899998 4,10.899998z M22,6.2999898L23,6.2999898 23,7.1999842C23.599976,7.1999842,24,7.3999964,24.200012,7.5000025L24.299988,7.5999781 24,8.5999786 23.799988,8.500003C23.599976,8.3999969 23.200012,8.1999847 22.599976,8.1999847 22.099976,8.1999847 21.900024,8.3999969 21.900024,8.6999847 21.900024,9.000003 22.200012,9.1999847 22.900024,9.500003 24,9.8999969 24.5,10.500004 24.5,11.399998 24.5,12.299992 23.900024,13.000005 22.900024,13.199987L22.900024,14.199987 21.799988,14.199987 21.799988,13.299993C21.299988,13.299993,20.700012,13.09998,20.400024,12.899999L20.299988,12.799993 20.599976,11.59998 20.799988,11.699986C21,11.799992 21.5,12.09998 22.200012,12.09998 22.700012,12.09998 23.099976,11.899998 23.099976,11.500004 23.099976,11.199986 22.900024,11.000004 22.200012,10.699986 21.400024,10.399998 20.5,9.8999969 20.5,8.8999969 20.5,8.000003 21.099976,7.3999964 22,7.1999842z M4,6.2999898L11.700012,6.2999898 11.700012,7.6999842 4,7.6999842z M22.400024,4.2999893C24.700012,4.2999893 26.700012,5.5999776 27.599976,7.5000025 27.700012,7.6999842 27.799988,7.8999964 27.900024,8.0999786 28,8.7999908 27.200012,8.8999969 26.900024,8.5999786 26.799988,8.500003 26.599976,8.1999847 26.5,8.000003 25.700012,6.500002 24.200012,5.500002 22.400024,5.500002 20.799988,5.500002 19.5,6.2999898 18.599976,7.5000025L19.200012,7.5999781C19.200012,7.5999781,19.5,7.5999781,19.299988,7.7999903L17.099976,8.7999908C17,8.7999908,17,8.7999908,17,8.6999847L17.099976,6.2999898C17.099976,6.000002,17.299988,6.2999898,17.299988,6.2999898L17.599976,6.7999903C18.700012,5.2999893,20.5,4.2999893,22.400024,4.2999893z M1.5999756,1.5000005L1.5999756,18.799995 30.400024,18.799995 30.400024,1.5000005z M0,0L32,0 32,20.400001 0,20.400001z"
                                                RenderTransformOrigin="0.5,0.5"
                                                Stretch="Uniform" />
                                            </Grid>
                                        </Viewbox>
                                        <StackPanel
                                        Width="185"
                                        Margin="5"
                                        Orientation="Vertical">
                                            <TextBlock
                                            Margin="1"
                                            HorizontalAlignment="Stretch"
                                            FontSize="12"
                                            FontWeight="Bold"
                                            Text="{Binding NumeroFactura}"
                                            TextWrapping="Wrap" />
                                            <TextBlock
                                            Margin="1"
                                            HorizontalAlignment="Stretch"
                                            FontSize="10"
                                            Text="{Binding NombrePlanta}"
                                            TextWrapping="Wrap" />
                                            <TextBlock
                                            Margin="1"
                                            HorizontalAlignment="Stretch"
                                            Foreground="{Binding Estado, Converter={StaticResource StateValueToColorConverter}}"
                                            FontSize="12"
                                            FontWeight="Bold"
                                            Text="{Binding Estado}"
                                            TextWrapping="Wrap" />
                                            <Rectangle Height="6" Style="{StaticResource EstiloRectanguloEnListas}" />
                                        </StackPanel>
                                    </StackPanel>
                                </DataTemplate>
                            </ListBox.ItemTemplate>
                        </ListBox>
                        <misControles:PaginarControl
						Grid.Row="2"
						Width="170"
						Background="{DynamicResource AccentColorBrush}"
						ComandoAnterior="{Binding ComandoNavegarFacturas}"
						ComandoSiguiente="{Binding ComandoNavegarFacturas}"
						NumeroPagina="{Binding NumeroPaginaFacturas, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
						TotalPaginas="{Binding BusquedaFacturasControl.TotalPagina}" />
                    </Grid>
                </GroupBox>
                <Grid Grid.Column="1">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto" />
                        <RowDefinition />
                    </Grid.RowDefinitions>
                    <GroupBox Header="Datos Generales de la Factura">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto" />
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="Auto" />
                                <ColumnDefinition Width="*" />
                            </Grid.ColumnDefinitions>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto" MinHeight="30" />
                                <RowDefinition Height="Auto" MinHeight="30" />
                                <RowDefinition Height="Auto" MinHeight="30"/>
                                <RowDefinition Height="Auto" />
                                <RowDefinition Height="Auto" />
                                <RowDefinition Height="Auto" MinHeight="30" />
                                <RowDefinition Height="Auto" MinHeight="30" />
                                <RowDefinition Height="Auto" />
                                <RowDefinition Height="Auto" />
                                <RowDefinition Height="Auto" MinHeight="30" />
                            </Grid.RowDefinitions>
                            <misControles:HeaderTextBlock
							Margin="5"
							Text="Número Factura"
                                FontWeight="DemiBold"
							TextWrapping="Wrap" />
                            <misControles:BodyTextBlock
							Grid.Column="1"
							Margin="5"
							Text="{Binding FacturaSeleccionada.NumeroFactura, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />
                            <misControles:HeaderTextBlock
							Margin="5"
                            Grid.Column="2"
                            Grid.Row="0"
							Text="Planta"
                                FontWeight="DemiBold"
							TextWrapping="Wrap" />
                            <misControles:BodyTextBlock
							Grid.Column="3"
                            Grid.Row="0"
							Margin="5"
							Text="{Binding FacturaSeleccionada.NombrePlanta, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />
                            <misControles:HeaderTextBlock
                            Grid.Row="1"
							Margin="5"
							Text="Conteo"
                                FontWeight="DemiBold"
							TextWrapping="Wrap" />
                            <misControles:BodyTextBlock
                            Grid.Row="1"
							Grid.Column="1"
							Margin="5"
                            FontWeight="SemiBold"
							Text="{Binding FacturaSeleccionada.ConteoFacturas, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />

                            <misControles:HeaderTextBlock
                            Grid.Row="2"
							Margin="5"
							Text="Estado"
                                FontWeight="DemiBold"
							TextWrapping="Wrap" />
                            <misControles:BodyTextBlock
                            Grid.Row="2"
							Grid.Column="1"
							Margin="5"
                            FontWeight="SemiBold"
							Text="{Binding FacturaSeleccionada.Estado, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />

                            <misControles:HeaderTextBlock
                            Grid.Row="2"
                            Grid.Column="2"
							Margin="5"
							Text="Boletas con P/U"
                                FontWeight="DemiBold"
							TextWrapping="Wrap" />
                            <misControles:BodyTextBlock
                            Grid.Row="2"
							Grid.Column="3"
							Margin="5"
                            FontWeight="SemiBold"
							Text="{Binding FacturaSeleccionada.HasUnitPriceItem, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />

                            <misControles:HeaderTextBlock
                            Grid.Row="1"
                            Grid.Column="2"
							Margin="5"
							Text="Fecha Emisión"
                                FontWeight="DemiBold"
							TextWrapping="Wrap" />
                            <misControles:BodyTextBlock
                            Grid.Row="1"
							Grid.Column="3"
							Margin="5"
							Text="{Binding FacturaSeleccionada.Fecha, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged, StringFormat=D}" />
                            <misControles:HeaderTextBlock
							Grid.Row="4"
							Margin="5"
							Text="Sub-Total $"
                                FontWeight="DemiBold"
							TextWrapping="Wrap" 
                                Visibility="{Binding FacturaSeleccionada.IsForeignCurrency, Converter={StaticResource BoolToVisibilityConverter}}"/>
                            <misControles:BodyTextBlock
							Grid.Row="4"
							Grid.Column="1"
							Margin="5"
							Text="{Binding FacturaSeleccionada.SubTotalDollar, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged, StringFormat=N2}" 
                                Visibility="{Binding FacturaSeleccionada.IsForeignCurrency, Converter={StaticResource BoolToVisibilityConverter}}"/>
                            <misControles:HeaderTextBlock
							Grid.Row="4"
                            Grid.Column="2"
							Margin="5"
							Text="Total $"
                                FontWeight="DemiBold"
							TextWrapping="Wrap" 
                                Visibility="{Binding FacturaSeleccionada.IsForeignCurrency, Converter={StaticResource BoolToVisibilityConverter}}"/>
                            <misControles:BodyTextBlock
							Grid.Row="4"
							Grid.Column="3"
							Margin="5"
							Text="{Binding FacturaSeleccionada.InvoiceForeignTotal, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged, StringFormat=N2}" 
                                Visibility="{Binding FacturaSeleccionada.IsForeignCurrency, Converter={StaticResource BoolToVisibilityConverter}}"/>
                            <misControles:HeaderTextBlock
							Grid.Row="3"
                            Grid.Column="0"
							Margin="5"
							Text="ISV %"
                                FontWeight="DemiBold"
							TextWrapping="Wrap" 
                                Visibility="{Binding FacturaSeleccionada.IsExonerated, ConverterParameter=INVERTIR, Converter={StaticResource BoolToVisibilityConverter}}"/>
                            <misControles:BodyTextBlock
							Grid.Row="3"
							Grid.Column="1"
							Margin="5"
							Text="{Binding FacturaSeleccionada.TaxPercent, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged, StringFormat=N2}"
                                Visibility="{Binding FacturaSeleccionada.IsExonerated, ConverterParameter=INVERTIR, Converter={StaticResource BoolToVisibilityConverter}}"/>
                            <misControles:HeaderTextBlock
							Grid.Row="3"
                            Grid.Column="2"
							Margin="5"
							Text="ISV Lps"
                                FontWeight="DemiBold"
							TextWrapping="Wrap" 
                                Visibility="{Binding FacturaSeleccionada.IsExonerated, ConverterParameter=INVERTIR, Converter={StaticResource BoolToVisibilityConverter}}"/>
                            <misControles:BodyTextBlock
							Grid.Row="3"
							Grid.Column="3"
							Margin="5"
							Text="{Binding FacturaSeleccionada.Tax, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged, StringFormat=N2}" 
                                Visibility="{Binding FacturaSeleccionada.IsExonerated, ConverterParameter=INVERTIR, Converter={StaticResource BoolToVisibilityConverter}}"/>
                            <misControles:HeaderTextBlock
							Grid.Row="5"
                            Grid.Column="0"
							Margin="5"
							Text="Sub-Total Lps"
                                FontWeight="DemiBold"
							TextWrapping="Wrap" />
                            <misControles:BodyTextBlock
							Grid.Row="5"
							Grid.Column="1"
							Margin="5"
							Text="{Binding FacturaSeleccionada.SubTotalLps, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged, StringFormat=N2}" />
                            <misControles:HeaderTextBlock
							Grid.Row="5"
                            Grid.Column="2"
							Margin="5"
							Text="Total Lps"
                                FontWeight="DemiBold"
							TextWrapping="Wrap" />
                            <misControles:BodyTextBlock
							Grid.Row="5"
							Grid.Column="3"
							Margin="5"
							Text="{Binding FacturaSeleccionada.InvoiceLocalTotal, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged, StringFormat=N2}" />
                            <misControles:HeaderTextBlock
							Grid.Row="6"
							Margin="5"
							Text="Empresa"
                            FontWeight="DemiBold"
							TextWrapping="Wrap" />
                            <misControles:BodyTextBlock
							Grid.Row="6"
							Grid.Column="1"
							Margin="5"
							Text="{Binding FacturaSeleccionada.NombreSucursal, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />
                            <misControles:HeaderTextBlock
							Grid.Row="6"
                            Grid.Column="2"
							Margin="5"
							Text="Semana"
                                FontWeight="DemiBold"
							TextWrapping="Wrap" />
                            <misControles:BodyTextBlock
							Grid.Row="6"
							Grid.Column="3"
							Margin="5"
							Text="{Binding FacturaSeleccionada.Semana, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />
                            <misControles:HeaderTextBlock
							Grid.Row="7"
                            Grid.Column="0"
							Margin="5"
							Text="Proforma"
                                FontWeight="DemiBold"
							TextWrapping="Wrap" 
                                Visibility="{Binding FacturaSeleccionada.RequiereProForm, Converter={StaticResource BoolToVisibilityConverter}}"/>
                            <misControles:BodyTextBlock
							Grid.Row="7"
							Grid.Column="1"
							Margin="5"
							Text="{Binding FacturaSeleccionada.ProFormaNo, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" 
                                Visibility="{Binding FacturaSeleccionada.RequiereProForm, Converter={StaticResource BoolToVisibilityConverter}}"/>
                            <misControles:HeaderTextBlock
							Grid.Row="7"
                            Grid.Column="2"
							Margin="5"
							Text="SubPlanta"
                                FontWeight="DemiBold"
							TextWrapping="Wrap" 
                                Visibility="{Binding FacturaSeleccionada.HasSubPlanta, Converter={StaticResource BoolToVisibilityConverter}}"/>
                            <misControles:BodyTextBlock
							Grid.Row="7"
							Grid.Column="3"
							Margin="5"
							Text="{Binding FacturaSeleccionada.NombreSubPlanta, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" 
                                Visibility="{Binding FacturaSeleccionada.HasSubPlanta, Converter={StaticResource BoolToVisibilityConverter}}"/>
                            <misControles:HeaderTextBlock
							Grid.Row="8"
                            Grid.Column="0"
							Margin="5"
							Text="# PO"
                                FontWeight="DemiBold"
							TextWrapping="Wrap" 
                                Visibility="{Binding FacturaSeleccionada.RequiereOrdenCompra, Converter={StaticResource BoolToVisibilityConverter}}"/>
                            <misControles:BodyTextBlock
							Grid.Row="8"
							Grid.Column="1"
							Margin="5"
							Text="{Binding FacturaSeleccionada.OrdenCompra, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" 
                                Visibility="{Binding FacturaSeleccionada.RequiereOrdenCompra, Converter={StaticResource BoolToVisibilityConverter}}"/>
                            <misControles:HeaderTextBlock
							Grid.Row="8"
                            Grid.Column="2"
							Margin="5"
							Text="# Exoneración DEI"
                                FontWeight="DemiBold"
							TextWrapping="Wrap"
                                Visibility="{Binding FacturaSeleccionada.RequiereOrdenCompra, Converter={StaticResource BoolToVisibilityConverter}}"/>
                            <misControles:BodyTextBlock
							Grid.Row="8"
							Grid.Column="3"
							Margin="5"
							Text="{Binding FacturaSeleccionada.ExonerationNo, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" 
                                Visibility="{Binding FacturaSeleccionada.RequiereOrdenCompra, Converter={StaticResource BoolToVisibilityConverter}}"/>
                            <misControles:HeaderTextBlock
							Grid.Row="9"
							Margin="5"
							Text="Observaciones"
                                FontWeight="DemiBold"
							TextWrapping="Wrap" />
                            <misControles:BodyTextBlock
							Grid.Row="9"
							Grid.Column="1"
                            Grid.ColumnSpan="3"
							Margin="5"
							Text="{Binding FacturaSeleccionada.Observaciones, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />
                        </Grid>
                    </GroupBox>
                    <TabControl Grid.Row="1">
                        <TabItem controlsMahApps:ControlsHelper.HeaderFontSize="16" Header="Items">
                            <Grid>
                                <Grid>
                                    <Grid.RowDefinitions>
                                        <RowDefinition />
                                        <RowDefinition Height="Auto"/>
                                    </Grid.RowDefinitions>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition />
                                        <ColumnDefinition Width="Auto" />
                                    </Grid.ColumnDefinitions>
                                    <DataGrid Grid.Column="0" Grid.ColumnSpan="2"
									AutoGenerateColumns="False"
									IsReadOnly="True"
									ItemsSource="{Binding InvoiceDetailItems}">
                                        <DataGrid.Columns>
                                            <DataGridTextColumn Binding="{Binding Cantidad, StringFormat=N2}" Header="Cantidad" />
                                            <DataGridTextColumn Binding="{Binding ProductoDescripcion}" Header="Descripción" />
                                            <DataGridTemplateColumn Header="Precio">
                                                <DataGridTemplateColumn.CellTemplate>
                                                    <DataTemplate>
                                                        <TextBlock Text="{Binding Precio, StringFormat=N2}" HorizontalAlignment="Right"/>
                                                    </DataTemplate>
                                                </DataGridTemplateColumn.CellTemplate>
                                            </DataGridTemplateColumn>
                                            <DataGridTemplateColumn Header="$ Total">
                                                <DataGridTemplateColumn.CellTemplate>
                                                    <DataTemplate>
                                                        <TextBlock Text="{Binding ForeignCurrencyItemAmount, StringFormat=N2}" HorizontalAlignment="Right"/>
                                                    </DataTemplate>
                                                </DataGridTemplateColumn.CellTemplate>
                                            </DataGridTemplateColumn>
                                            <DataGridTemplateColumn Header="Lps Total">
                                                <DataGridTemplateColumn.CellTemplate>
                                                    <DataTemplate>
                                                        <TextBlock Text="{Binding LocalCurrencyItemAmount, StringFormat=N2}" HorizontalAlignment="Right"/>
                                                    </DataTemplate>
                                                </DataGridTemplateColumn.CellTemplate>
                                            </DataGridTemplateColumn>
                                        </DataGrid.Columns>
                                    </DataGrid>
                                    <!--Dollars-->
                                    <Grid Grid.Row="1" HorizontalAlignment="Right" Grid.Column="0">
                                        <Grid.RowDefinitions>
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="Auto" />
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="Auto" />
                                        </Grid.RowDefinitions>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="Auto" />
                                            <ColumnDefinition MinWidth="100" />
                                        </Grid.ColumnDefinitions>
                                        <!--headers-->
                                        <misControles:HeaderTextBlock Grid.Row="0"
                                                                 FontSize="14"
                                                                 Text="Dollars"
                                                                 FontWeight="SemiBold" Grid.Column="0" Grid.ColumnSpan="2"
                                                                      HorizontalAlignment="Center"
                                                                      Visibility="{Binding FacturaSeleccionada.IsForeignCurrency,  Converter={StaticResource BoolToVisibilityConverter}}"/>
                                        <misControles:HeaderTextBlock Grid.Row="1"
                                                                 FontSize="14"
                                                                 Text="Sub-Total"
                                                                 FontWeight="SemiBold" Grid.Column="0"
                                                                      Visibility="{Binding FacturaSeleccionada.IsForeignCurrency, Converter={StaticResource BoolToVisibilityConverter}}"/>
                                        <misControles:BodyTextBlock Grid.Row="1"
                                                               Grid.Column="1"
                                                               FontSize="14"
                                                               FontWeight="Bold"
                                                               Text="{Binding FacturaSeleccionada.SubTotalDollar,
                                                                              Mode=TwoWay,
                                                                              UpdateSourceTrigger=PropertyChanged,
                                                                              StringFormat=N2}"
                                                               TextAlignment="Right" 
                                                                    Visibility="{Binding FacturaSeleccionada.IsForeignCurrency, Converter={StaticResource BoolToVisibilityConverter}}"/>
                                        <misControles:HeaderTextBlock Grid.Row="2"
                                                                 FontSize="14"
                                                                 Text="Total"
                                                                 FontWeight="SemiBold" Grid.Column="0"
                                                                      Visibility="{Binding FacturaSeleccionada.IsForeignCurrency, Converter={StaticResource BoolToVisibilityConverter}}"/>
                                        <misControles:BodyTextBlock Grid.Row="2"
                                                               Grid.Column="1"
                                                               FontSize="14"
                                                               FontWeight="Bold"
                                                               Text="{Binding FacturaSeleccionada.InvoiceForeignTotal,
                                                                              Mode=TwoWay,
                                                                              UpdateSourceTrigger=PropertyChanged,
                                                                              StringFormat=N2}"
                                                               TextAlignment="Right" 
                                                                    Visibility="{Binding FacturaSeleccionada.IsForeignCurrency, Converter={StaticResource BoolToVisibilityConverter}}"/>
                                    </Grid>
                                    <!--Lps-->
                                    <Grid Grid.Row="1" HorizontalAlignment="Right" Grid.Column="1">
                                        <Grid.RowDefinitions>
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="Auto" />
                                            <RowDefinition Height="Auto" />
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="Auto" />
                                        </Grid.RowDefinitions>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="Auto" />
                                            <ColumnDefinition MinWidth="100" />
                                        </Grid.ColumnDefinitions>
                                        <!--headers-->
                                        <misControles:HeaderTextBlock Grid.Row="0"
                                                                 FontSize="14"
                                                                 Text="Lempiras"
                                                                 FontWeight="SemiBold" Grid.Column="0" Grid.ColumnSpan="2"
                                                                      HorizontalAlignment="Center"/>

                                        <misControles:HeaderTextBlock Grid.Row="1"
                                                                 FontSize="14"
                                                                 Text="Sub-Total"
                                                                 FontWeight="SemiBold" Grid.Column="0"/>
                                        <misControles:BodyTextBlock Grid.Row="1"
                                                               Grid.Column="1"
                                                               FontSize="14"
                                                               FontWeight="Bold"
                                                               Text="{Binding FacturaSeleccionada.SubTotalLps,
                                                                              Mode=TwoWay,
                                                                              UpdateSourceTrigger=PropertyChanged,
                                                                              StringFormat=N2}"
                                                               TextAlignment="Right" />
                                        <misControles:HeaderTextBlock Grid.Row="2"
                                                                 FontSize="14"
                                                                 Text="ISV"
                                                                 FontWeight="SemiBold" Grid.Column="0"
                                                                      Visibility="{Binding FacturaSeleccionada.IsExonerated, ConverterParameter=INVERTIR, Converter={StaticResource BoolToVisibilityConverter}}"/>
                                        <misControles:BodyTextBlock Grid.Row="2"
                                                               Grid.Column="1"
                                                               FontSize="14"
                                                               FontWeight="Bold"
                                                               Text="{Binding FacturaSeleccionada.Tax,
                                                                              Mode=TwoWay,
                                                                              UpdateSourceTrigger=PropertyChanged,
                                                                              StringFormat=N2}"
                                                               TextAlignment="Right"
                                                                    Visibility="{Binding FacturaSeleccionada.IsExonerated, ConverterParameter=INVERTIR, Converter={StaticResource BoolToVisibilityConverter}}"/>
                                        <misControles:HeaderTextBlock Grid.Row="3"
                                                                 FontSize="14"
                                                                 Text="Total"
                                                                 FontWeight="SemiBold" Grid.Column="0"/>
                                        <misControles:BodyTextBlock Grid.Row="3"
                                                               Grid.Column="1"
                                                               FontSize="14"
                                                               FontWeight="Bold"
                                                               Text="{Binding FacturaSeleccionada.InvoiceLocalTotal,
                                                                              Mode=TwoWay,
                                                                              UpdateSourceTrigger=PropertyChanged,
                                                                              StringFormat=N2}"
                                                               TextAlignment="Right" />
                                    </Grid>
                                </Grid>
                            </Grid>
                        </TabItem>
                        <TabItem controlsMahApps:ControlsHelper.HeaderFontSize="16" Header="Boletas"
                                 Visibility="{Binding IsVisibleBillingPermission, Converter={StaticResource BoolToVisibilityConverter}}">
                            <Grid>
                                <Grid>
                                    <Grid.RowDefinitions>
                                        <RowDefinition />
                                    </Grid.RowDefinitions>
                                    <DataGrid
									AutoGenerateColumns="False"
									IsReadOnly="True"
									ItemsSource="{Binding ListaFacturaDetalleBoletas}">
                                        <DataGrid.Columns>
                                            <DataGridTemplateColumn Header="Boleta">
                                                <DataGridTemplateColumn.CellTemplate>
                                                    <DataTemplate>
                                                        <TextBlock Text="{Binding CodigoBoleta}" HorizontalAlignment="Center"
                                                                   Foreground="{Binding HasErrorWeightOrPrice, Converter={StaticResource BoolToColorConverter}}"/>
                                                    </DataTemplate>
                                                </DataGridTemplateColumn.CellTemplate>
                                            </DataGridTemplateColumn>
                                            <DataGridTemplateColumn Header="#Envio">
                                                <DataGridTemplateColumn.CellTemplate>
                                                    <DataTemplate>
                                                        <TextBlock Text="{Binding NumeroEnvio}" HorizontalAlignment="Center"
                                                                   Foreground="{Binding HasErrorWeightOrPrice, Converter={StaticResource BoolToColorConverter}}"/>
                                                    </DataTemplate>
                                                </DataGridTemplateColumn.CellTemplate>
                                            </DataGridTemplateColumn>
                                            <DataGridTemplateColumn Header="Producto">
                                                <DataGridTemplateColumn.CellTemplate>
                                                    <DataTemplate>
                                                        <TextBlock Text="{Binding DescripcionTipoProducto}" HorizontalAlignment="Center"
                                                                   Foreground="{Binding HasErrorWeightOrPrice, Converter={StaticResource BoolToColorConverter}}"/>
                                                    </DataTemplate>
                                                </DataGridTemplateColumn.CellTemplate>
                                            </DataGridTemplateColumn>
                                            <DataGridTemplateColumn Header="Proveedor">
                                                <DataGridTemplateColumn.CellTemplate>
                                                    <DataTemplate>
                                                        <TextBlock Text="{Binding NombreProveedor}" HorizontalAlignment="Center"
                                                                   Foreground="{Binding HasErrorWeightOrPrice, Converter={StaticResource BoolToColorConverter}}"/>
                                                    </DataTemplate>
                                                </DataGridTemplateColumn.CellTemplate>
                                            </DataGridTemplateColumn>
                                            <DataGridTemplateColumn Header="Placa">
                                                <DataGridTemplateColumn.CellTemplate>
                                                    <DataTemplate>
                                                        <TextBlock Text="{Binding PlacaEquipo}" HorizontalAlignment="Center"
                                                                   Foreground="{Binding HasErrorWeightOrPrice, Converter={StaticResource BoolToColorConverter}}"/>
                                                    </DataTemplate>
                                                </DataGridTemplateColumn.CellTemplate>
                                            </DataGridTemplateColumn>
                                            <DataGridTemplateColumn Header="Peso Compra">
                                                <DataGridTemplateColumn.CellTemplate>
                                                    <DataTemplate>
                                                        <TextBlock Text="{Binding PesoProductoCompra, StringFormat=N2}" HorizontalAlignment="Right"
                                                                   Foreground="{Binding HasErrorWeightOrPrice, Converter={StaticResource BoolToColorConverter}}"/>
                                                    </DataTemplate>
                                                </DataGridTemplateColumn.CellTemplate>
                                            </DataGridTemplateColumn>
                                            <DataGridTemplateColumn Header="Precio Compra">
                                                <DataGridTemplateColumn.CellTemplate>
                                                    <DataTemplate>
                                                        <TextBlock Text="{Binding PrecioProductoCompra, StringFormat=N2}" HorizontalAlignment="Right"
                                                                   Foreground="{Binding HasErrorWeightOrPrice, Converter={StaticResource BoolToColorConverter}}"/>
                                                    </DataTemplate>
                                                </DataGridTemplateColumn.CellTemplate>
                                            </DataGridTemplateColumn>
                                            <DataGridTemplateColumn Header="Peso Venta">
                                                <DataGridTemplateColumn.CellTemplate>
                                                    <DataTemplate>
                                                        <TextBlock Text="{Binding PesoProducto, StringFormat=N2}" HorizontalAlignment="Right"
                                                                   Foreground="{Binding HasErrorWeightOrPrice, Converter={StaticResource BoolToColorConverter}}"/>
                                                    </DataTemplate>
                                                </DataGridTemplateColumn.CellTemplate>
                                            </DataGridTemplateColumn>
                                            <DataGridTemplateColumn Header="Precio Venta">
                                                <DataGridTemplateColumn.CellTemplate>
                                                    <DataTemplate>
                                                        <TextBlock Text="{Binding PrecioVenta, StringFormat=N2}" HorizontalAlignment="Right"
                                                                   Foreground="{Binding HasErrorWeightOrPrice, Converter={StaticResource BoolToColorConverter}}"/>
                                                    </DataTemplate>
                                                </DataGridTemplateColumn.CellTemplate>
                                                <!--<DataGridTemplateColumn.CellStyle>
                                                    <Style TargetType="{x:Type DataGridCell}">
                                                        <Setter Property="Visibility" Value="{Binding DataContext.IsVisibleBillingPermission, RelativeSource={RelativeSource Mode=FindAncestor, AncestorType=DataGrid}}"/>
                                                    </Style>
                                                </DataGridTemplateColumn.CellStyle>-->
                                            </DataGridTemplateColumn>
                                            <DataGridTemplateColumn Header="Ganancia">
                                                <DataGridTemplateColumn.CellTemplate>
                                                    <DataTemplate>
                                                        <TextBlock Text="{Binding Profit, StringFormat=N2}" HorizontalAlignment="Right"
                                                                   Foreground="{Binding HasErrorWeightOrPrice, Converter={StaticResource BoolToColorConverter}}"/>
                                                    </DataTemplate>
                                                </DataGridTemplateColumn.CellTemplate>
                                            </DataGridTemplateColumn>
                                        </DataGrid.Columns>
                                    </DataGrid>
                                </Grid>
                            </Grid>
                        </TabItem>
                        <TabItem controlsMahApps:ControlsHelper.HeaderFontSize="16" Header="Boletas"
                                 Visibility="{Binding IsVisibleBillingPermission, ConverterParameter=INVERTIR, Converter={StaticResource BoolToVisibilityConverter}}">
                            <Grid>
                                <Grid>
                                    <Grid.RowDefinitions>
                                        <RowDefinition />
                                    </Grid.RowDefinitions>
                                    <DataGrid
									AutoGenerateColumns="False"
									IsReadOnly="True"
									ItemsSource="{Binding ListaFacturaDetalleBoletas}">
                                        <DataGrid.Columns>
                                            <DataGridTemplateColumn Header="Boleta">
                                                <DataGridTemplateColumn.CellTemplate>
                                                    <DataTemplate>
                                                        <TextBlock Text="{Binding CodigoBoleta}" HorizontalAlignment="Right"
                                                                   Foreground="{Binding HasErrorWeightOrPrice, Converter={StaticResource BoolToColorConverter}}"/>
                                                    </DataTemplate>
                                                </DataGridTemplateColumn.CellTemplate>
                                            </DataGridTemplateColumn>
                                            <DataGridTemplateColumn Header="#Envio">
                                                <DataGridTemplateColumn.CellTemplate>
                                                    <DataTemplate>
                                                        <TextBlock Text="{Binding NumeroEnvio}" HorizontalAlignment="Right"
                                                                   Foreground="{Binding HasErrorWeightOrPrice, Converter={StaticResource BoolToColorConverter}}"/>
                                                    </DataTemplate>
                                                </DataGridTemplateColumn.CellTemplate>
                                            </DataGridTemplateColumn>
                                            <DataGridTemplateColumn Header="Producto">
                                                <DataGridTemplateColumn.CellTemplate>
                                                    <DataTemplate>
                                                        <TextBlock Text="{Binding DescripcionTipoProducto}" HorizontalAlignment="Right"
                                                                   Foreground="{Binding HasErrorWeightOrPrice, Converter={StaticResource BoolToColorConverter}}"/>
                                                    </DataTemplate>
                                                </DataGridTemplateColumn.CellTemplate>
                                            </DataGridTemplateColumn>
                                            <DataGridTemplateColumn Header="Proveedor">
                                                <DataGridTemplateColumn.CellTemplate>
                                                    <DataTemplate>
                                                        <TextBlock Text="{Binding NombreProveedor}" HorizontalAlignment="Right"
                                                                   Foreground="{Binding HasErrorWeightOrPrice, Converter={StaticResource BoolToColorConverter}}"/>
                                                    </DataTemplate>
                                                </DataGridTemplateColumn.CellTemplate>
                                            </DataGridTemplateColumn>
                                            <DataGridTemplateColumn Header="Placa">
                                                <DataGridTemplateColumn.CellTemplate>
                                                    <DataTemplate>
                                                        <TextBlock Text="{Binding PlacaEquipo}" HorizontalAlignment="Right"
                                                                   Foreground="{Binding HasErrorWeightOrPrice, Converter={StaticResource BoolToColorConverter}}"/>
                                                    </DataTemplate>
                                                </DataGridTemplateColumn.CellTemplate>
                                            </DataGridTemplateColumn>
                                            <DataGridTemplateColumn Header="Peso Compra">
                                                <DataGridTemplateColumn.CellTemplate>
                                                    <DataTemplate>
                                                        <TextBlock Text="{Binding PesoProductoCompra, StringFormat=N2}" HorizontalAlignment="Right"
                                                                   Foreground="{Binding HasErrorWeightOrPrice, Converter={StaticResource BoolToColorConverter}}"/>
                                                    </DataTemplate>
                                                </DataGridTemplateColumn.CellTemplate>
                                            </DataGridTemplateColumn>
                                            <DataGridTemplateColumn Header="Precio Compra">
                                                <DataGridTemplateColumn.CellTemplate>
                                                    <DataTemplate>
                                                        <TextBlock Text="{Binding PrecioProductoCompra, StringFormat=N2}" HorizontalAlignment="Right"
                                                                   Foreground="{Binding HasErrorWeightOrPrice, Converter={StaticResource BoolToColorConverter}}"/>
                                                    </DataTemplate>
                                                </DataGridTemplateColumn.CellTemplate>
                                            </DataGridTemplateColumn>
                                            <DataGridTemplateColumn Header="Peso Venta">
                                                <DataGridTemplateColumn.CellTemplate>
                                                    <DataTemplate>
                                                        <TextBlock Text="{Binding PesoProducto, StringFormat=N2}" HorizontalAlignment="Right"
                                                                   Foreground="{Binding HasErrorWeightOrPrice, Converter={StaticResource BoolToColorConverter}}"/>
                                                    </DataTemplate>
                                                </DataGridTemplateColumn.CellTemplate>
                                            </DataGridTemplateColumn>
                                        </DataGrid.Columns>
                                    </DataGrid>
                                </Grid>
                            </Grid>
                        </TabItem>
                        <TabItem controlsMahApps:ControlsHelper.HeaderFontSize="16" Header="Notas Crédito">
                            <Grid>
                                <Grid>
                                    <Grid.RowDefinitions>
                                        <RowDefinition />
                                    </Grid.RowDefinitions>
                                    <DataGrid
									AutoGenerateColumns="False"
									IsReadOnly="True"
									ItemsSource="{Binding NotasCredito}">
                                        <DataGrid.Columns>
                                            <DataGridTextColumn Binding="{Binding NotaCreditoNo}" Header="#Nota Crédito" />
                                            <DataGridTextColumn Binding="{Binding Monto, StringFormat=N2}" Header="Monto" />
                                            <DataGridTextColumn Binding="{Binding Observaciones}" Header="Observaciones" />
                                        </DataGrid.Columns>
                                    </DataGrid>
                                </Grid>
                            </Grid>
                        </TabItem>
                        <TabItem controlsMahApps:ControlsHelper.HeaderFontSize="16" Header="Pagos">
                            <Grid>
                                <Grid>
                                    <Grid.RowDefinitions>
                                        <RowDefinition />
                                    </Grid.RowDefinitions>
                                    <DataGrid
									AutoGenerateColumns="False"
									IsReadOnly="True"
									ItemsSource="{Binding InvoicePaids}">
                                        <DataGrid.Columns>
                                            <DataGridTextColumn Binding="{Binding FechaDePago, StringFormat=d}" Header="Fecha Pago" />
                                            <DataGridTextColumn Binding="{Binding FormaDePago}" Header="Forma Pago" />
                                            <DataGridTextColumn Binding="{Binding NombreBanco}" Header="Banco" />
                                            <DataGridTextColumn Binding="{Binding ReferenciaBancaria}" Header="Ref" />
                                            <DataGridTextColumn Binding="{Binding Monto, StringFormat=N2}" Header="Monto"/>
                                        </DataGrid.Columns>
                                    </DataGrid>
                                </Grid>
                            </Grid>
                        </TabItem>
                    </TabControl>
                </Grid>
            </Grid>
            <misControles:AppBarPanel Grid.Row="1" Background="{DynamicResource AccentColorBrush}">
                <misControles:AppBarButton
				Command="{Binding ComandoMostrarCrearFactura}"
				Imagen="{DynamicResource AgregarPathImagen}"
				Titulo="Crear"/>
                <misControles:AppBarButton
				Command="{Binding CommandShowEditInvoice}"
				Imagen="{DynamicResource EditarPathImagen}"
				Titulo="Editar"/>
                <misControles:AppBarButton
				Command="{Binding ComandoAnularFactura}"
				Imagen="{DynamicResource AnularPathImagen}"
				Titulo="Anular"/>
                <misControles:Separador />
                <misControles:AppBarButton
				Command="{Binding CommandActiveInvoice}"
				Imagen="{DynamicResource ActivarPrestamoPathImagen}"
				Titulo="Activar"/>
                <misControles:Separador />
                <misControles:AppBarButton
				Command="{Binding CommandShowInvoiceDetailItems}"
				Imagen="{DynamicResource InvoiceDetailPathImagen}"
				Titulo="Items" />
                <misControles:AppBarButton
				Command="{Binding ComandoMostrarDetalleBoletas}"
				Imagen="{DynamicResource DetalleBoletasPathImagen}"
				Titulo="Boletas" />
                <misControles:AppBarButton
				Command="{Binding CommandShowNotasCredito}"
				Imagen="{DynamicResource NotasCreditoPathImagen}"
				Titulo="Notas Crédito" />
                <misControles:Separador />
                <misControles:AppBarButton
				Command="{Binding ComandoMostrarBoletasPendientes}"
				Imagen="{DynamicResource BuscarBoletasPendientesFacturaPathImagen}"
				Titulo="Boletas Pendientes" />
                <misControles:Separador />
                <misControles:AppBarButton
				Command="{Binding CommandShowInvoicePayment}"
				Imagen="{DynamicResource PagosPathImagen}"
				Titulo="Pagos" />
                <misControles:Separador />
                <misControles:AppBarButton
                Command="{Binding ComandoImprimirFacturacion}"
                Imagen="{DynamicResource ImprimirPathImagen}"
                Titulo="Imprimir" />
                <misControles:Separador />
                <misControles:AppBarButton
				Command="{Binding ComandoRefrescar}"
				Imagen="{DynamicResource RefrescarPathImagen}"
				Titulo="Actualizar" />
            </misControles:AppBarPanel>
            <Border Grid.RowSpan="2" Visibility="{Binding MostrarVentanaEsperaPrincipal}" d:IsHidden="True">
                <Grid>
                    <misControles:BloqueoPanel/>
                    <controlsMahApps:ProgressRing IsActive="True" IsLarge="False"/>
                </Grid>
            </Border>
        </Grid>
    </Grid>
</wpfCoreWindow:MetroWindowExt>
